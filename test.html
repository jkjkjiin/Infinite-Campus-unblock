<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Campus</title>
    <link id="dynamic-favicon" rel="icon" type="image/png" href="https://codehs.com/uploads/f111a37947de2cea81db858094c04f2d">
    <link rel="stylesheet" href="global.css">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7SV03ZXJ9R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7SV03ZXJ9R');
    </script>

    <style>
        /* Optional: hide body initially to prevent flicker */
        body { display: none; }
    </style>
</head>
<body>
    <center>
        <br><br><br><br>
        <h1 class="txt">Log In</h1>
        <p class="r">Only Authorized Users May Log In</p>

        <input type="text" id="username" placeholder="Email" class="input button" style="padding:10px;width:250px;"><br><br>
        <input type="password" id="password" placeholder="Password" class="input button" style="padding:10px;width:250px;"><br><br>
        <button id="loginBtn" class="button">Log In</button>
        <p id="loginStatus"></p>
    </center>

    <!-- Firebase and login logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCd3Yi81oZbRFgcdc98e8hTatdM4pftYRs",
            authDomain: "infinitecampus-6e93c.firebaseapp.com",
            databaseURL: "https://infinitecampus-6e93c-default-rtdb.firebaseio.com",
            projectId: "infinitecampus-6e93c",
            storageBucket: "infinitecampus-6e93c.firebasestorage.app",
            messagingSenderId: "349851426947",
            appId: "1:349851426947:web:14cc56fab543ca91373bb6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const loginBtn = document.getElementById("loginBtn");
        const loginStatus = document.getElementById("loginStatus");

        // Wait for Firebase to confirm login state before showing the page
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Already logged in → redirect to secret page
                window.location.href = "Infinitesecretpages.html";
            } else {
                // Not logged in → show login page
                document.body.style.display = "block";
            }
        });

        // Login button handler
        loginBtn.addEventListener("click", async () => {
            const email = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                loginStatus.textContent = "Login successful! Redirecting...";
                // Redirect after successful login
                window.location.href = "Infinitesecretpages.html";
            } catch (error) {
                loginStatus.textContent = "Error: " + error.message;
            }
        });
    </script>
</body>
</html>
